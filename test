-- s0ul_hub_clean.lua
-- Version corrigée : GUI propre + toggles fonctionnels + stubs sûrs
-- NOTE: Ceci est destiné à Roblox Studio/local debug. Pas de FireServer / loadstring / os.execute.

local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Utility
local function new(name, class, parent)
	local obj = Instance.new(class)
	obj.Name = name
	obj.Parent = parent
	return obj
end

-- Root ScreenGui
local ScreenGui = new("s0ulScreenGui", "ScreenGui", playerGui)
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Main frame
local s0ul = new("s0ul", "Frame", ScreenGui)
s0ul.BackgroundColor3 = Color3.fromRGB(15,15,15)
s0ul.BorderSizePixel = 0
s0ul.Position = UDim2.new(0.58,0,0.30,0)
s0ul.Size = UDim2.new(0,549,0,344)
s0ul.Visible = false

Instance.new("UICorner", s0ul)

-- Title
local title = new("Title", "TextLabel", s0ul)
title.Size = UDim2.new(1,0,0,43)
title.Font = Enum.Font.SourceSans
title.Text = "s0ul hub"
title.TextSize = 50
title.TextColor3 = Color3.new(1,1,1)
title.BackgroundTransparency = 1

-- Close bar (bottom)
local closeBtn = new("CloseButton", "TextButton", s0ul)
closeBtn.Position = UDim2.new(0,0,0.944,0)
closeBtn.Size = UDim2.new(1,0,0,50)
closeBtn.Font = Enum.Font.SourceSans
closeBtn.Text = "Close Hub"
closeBtn.TextSize = 24
closeBtn.BackgroundColor3 = Color3.fromRGB(202,0,0)
closeBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", closeBtn)

-- Open icon (outside main)
local openIcon = new("OpenIcon", "ImageButton", ScreenGui)
openIcon.Position = UDim2.new(0.788,0,0.018,0)
openIcon.Size = UDim2.new(0,61,0,58)
openIcon.Image = "rbxassetid://11887506334"
Instance.new("UICorner", openIcon)

-- Section helper to create labelled toggle rows
local function createToggleRow(parent, y, labelText)
	local lbl = new("Label_"..labelText, "TextLabel", parent)
	lbl.Position = UDim2.new(0.15,0,y,0)
	lbl.Size = UDim2.new(0,200,0,40)
	lbl.Font = Enum.Font.SourceSans
	lbl.Text = labelText
	lbl.TextSize = 20
	lbl.TextColor3 = Color3.new(1,1,1)
	lbl.BackgroundTransparency = 1

	local container = new(labelText.."_container", "Frame", parent)
	container.Position = UDim2.new(0.58,0,y,0)
	container.Size = UDim2.new(0,80,0,28)
	container.BackgroundTransparency = 1

	local btnOn = new(labelText.."_On", "TextButton", container)
	btnOn.Size = UDim2.new(0,36,0,24)
	btnOn.Position = UDim2.new(0,0,0,0)
	btnOn.Text = "On"
	btnOn.Font = Enum.Font.SourceSans
	btnOn.TextSize = 16
	btnOn.BackgroundColor3 = Color3.fromRGB(255,100,100)
	btnOn.TextColor3 = Color3.new(1,1,1)
	Instance.new("UICorner", btnOn)

	local btnOff = new(labelText.."_Off", "TextButton", container)
	btnOff.Size = UDim2.new(0,36,0,24)
	btnOff.Position = UDim2.new(1,-36,0,0)
	btnOff.Text = "Off"
	btnOff.Font = Enum.Font.SourceSans
	btnOff.TextSize = 16
	btnOff.BackgroundColor3 = Color3.fromRGB(100,255,100)
	btnOff.TextColor3 = Color3.new(0,0,0)
	Instance.new("UICorner", btnOff)

	return {
		label = lbl,
		on = btnOn,
		off = btnOff,
	}
end

-- Create rows
local espRow = createToggleRow(s0ul, 0.18, "ESP")
local killsRow = createToggleRow(s0ul, 0.34, "KillCounter")
local cowRow = createToggleRow(s0ul, 0.50, "GetAllCow")
local afkRow = createToggleRow(s0ul, 0.66, "AntiAFK")
local farmRow = createToggleRow(s0ul, 0.82, "FarmHub")

-- Small label for "Farming" etc.
local farmingLabel = new("FarmingLabel", "TextLabel", s0ul)
farmingLabel.Position = UDim2.new(0.17,0,0.41,0)
farmingLabel.Size = UDim2.new(0,150,0,40)
farmingLabel.Font = Enum.Font.SourceSans
farmingLabel.Text = "Farming"
farmingLabel.TextSize = 30
farmingLabel.TextColor3 = Color3.new(1,1,1)
farmingLabel.BackgroundTransparency = 1

-- Kill counter floating window (spawned by pressing buttton_3 originally)
local function createKillCounterWindow()
	local sg = Instance.new("ScreenGui")
	sg.Name = "KillCounterWindow"
	sg.Parent = playerGui

	local frame = Instance.new("Frame", sg)
	frame.Size = UDim2.new(0,216,0,103)
	frame.Position = UDim2.new(0.4,0,0.05,0)
	frame.BackgroundTransparency = 0.5
	frame.BackgroundColor3 = Color3.fromRGB(47,47,47)
	Instance.new("UICorner", frame)

	local title = Instance.new("TextLabel", frame)
	title.Size = UDim2.new(1,0,0,36)
	title.Font = Enum.Font.SourceSansBold
	title.Text = "Kill counter"
	title.TextSize = 28
	title.BackgroundTransparency = 0.6
	title.TextColor3 = Color3.new(1,1,1)

	local killsLabel = Instance.new("TextLabel", frame)
	killsLabel.Position = UDim2.new(0.53,0,0.35,0)
	killsLabel.Size = UDim2.new(0,70,0,40)
	killsLabel.Font = Enum.Font.SourceSans
	killsLabel.Text = "0"
	killsLabel.TextSize = 30
	killsLabel.TextColor3 = Color3.new(1,1,1)
	killsLabel.BackgroundTransparency = 1

	local killsText = Instance.new("TextLabel", frame)
	killsText.Position = UDim2.new(0.15,0,0.35,0)
	killsText.Size = UDim2.new(0,80,0,40)
	killsText.Font = Enum.Font.SourceSans
	killsText.Text = "KILLS:"
	killsText.TextSize = 28
	killsText.TextColor3 = Color3.new(1,1,1)
	killsText.BackgroundTransparency = 1

	local close = Instance.new("TextButton", frame)
	close.Position = UDim2.new(0.83,0,-0.02,0)
	close.Size = UDim2.new(0,35,0,35)
	close.Text = "X"
	close.Font = Enum.Font.SourceSans
	close.TextSize = 20
	close.TextColor3 = Color3.fromRGB(213,0,0)
	close.BackgroundTransparency = 1

	close.MouseButton1Click:Connect(function()
		sg:Destroy()
	end)

	-- Safe way to show a kill stat if present in player (leaderstats/otherstats)
	local function update()
		local val = "0"
		if player:FindFirstChild("otherstats") and player.otherstats:FindFirstChild("Kill") then
			val = tostring(player.otherstats.Kill.Value)
		elseif player:FindFirstChild("leaderstats") and player.leaderstats:FindFirstChild("Kills") then
			val = tostring(player.leaderstats.Kills.Value)
		end
		killsLabel.Text = val
	end

	update()
	-- If stat exists, bind to changes
	if player:FindFirstChild("otherstats") and player.otherstats:FindFirstChild("Kill") then
		player.otherstats.Kill:GetPropertyChangedSignal("Value"):Connect(update)
	elseif player:FindFirstChild("leaderstats") and player.leaderstats:FindFirstChild("Kills") then
		player.leaderstats.Kills:GetPropertyChangedSignal("Value"):Connect(update)
	end
end

-- ESP implementation (local-only visual aid): toggles highlight on all characters locally
local espEnabled = false
local highlights = {}

local function createHighlightForCharacter(char)
	if not char or highlights[char] then return end
	local h = Instance.new("Highlight")
	h.Name = "s0ul_local_highlight"
	h.Adornee = char:FindFirstChildWhichIsA("Model") or char
	h.Parent = char
	h.FillTransparency = 0.6
	h.OutlineTransparency = 0
	highlights[char] = h
end

local function removeHighlights()
	for char,h in pairs(highlights) do
		if h and h.Parent then pcall(function() h:Destroy() end) end
	end
	highlights = {}
end

local function enableESP()
	espEnabled = true
	-- create highlights for existing characters
	for _, pl in pairs(Players:GetPlayers()) do
		if pl.Character then
			pcall(function() createHighlightForCharacter(pl.Character) end)
		end
	end
	-- listen for new characters (local-only)
	Players.PlayerAdded:Connect(function(pl)
		pl.CharacterAdded:Connect(function(char)
			if espEnabled then pcall(function() createHighlightForCharacter(char) end) end
		end)
	end)
	for _,pl in pairs(Players:GetPlayers()) do
		pl.CharacterAdded:Connect(function(char)
			if espEnabled then pcall(function() createHighlightForCharacter(char) end) end
		end)
	end
end

local function disableESP()
	espEnabled = false
	removeHighlights()
end

-- Connect UI logic (toggle buttons)
espRow.on.MouseButton1Click:Connect(function()
	enableESP()
	StarterGui:SetCore("SendNotification", {Title="s0ul Hub"; Text="ESP Enabled"; Duration=3})
end)
espRow.off.MouseButton1Click:Connect(function()
	disableESP()
	StarterGui:SetCore("SendNotification", {Title="s0ul Hub"; Text="ESP Disabled"; Duration=3})
end)

killsRow.on.MouseButton1Click:Connect(function()
	createKillCounterWindow()
	StarterGui:SetCore("SendNotification", {Title="s0ul Hub"; Text="Kill counter ouvert"; Duration=3})
end)
killsRow.off.MouseButton1Click:Connect(function()
	StarterGui:SetCore("SendNotification", {Title="s0ul Hub"; Text="Kill counter annulé (fermez la fenêtre si ouverte)"; Duration=3})
end)

-- GetAllCow -> STUB (sécurisé)
cowRow.on.MouseButton1Click:Connect(function()
	-- STUB: ici on ne fait PAS de FireServer ni d'appel externe.
	-- Remplacez ce bloc par la logique serveur appropriée si vous êtes le dev du jeu.
	StarterGui:SetCore("SendNotification", {Title="s0ul Hub"; Text="GetAllCow : action désactivée (stub sécurisé)"; Duration=4})
	print("[s0ul] GetAllCow appelé - Stub sécurisé (pas d'action côté serveur).")
end)
cowRow.off.MouseButton1Click:Connect(function()
	StarterGui:SetCore("SendNotification", {Title="s0ul Hub"; Text="GetAllCow désactivé"; Duration=3})
end)

-- Anti-AFK -> STUB (sécurisé)
afkRow.on.MouseButton1Click:Connect(function()
	-- STUB: Mise en place d'un anti-afk légitime doit se faire côté serveur.
	StarterGui:SetCore("SendNotification", {Title="s0ul Hub"; Text="Anti-AFK : stub activé (ne contourne pas le serveur)"; Duration=4})
	print("[s0ul] Anti-AFK activé (stub sécurisé).")
end)
afkRow.off.MouseButton1Click:Connect(function()
	StarterGui:SetCore("SendNotification", {Title="s0ul Hub"; Text="Anti-AFK désactivé"; Duration=3})
end)

-- FarmHub -> STUB
farmRow.on.MouseButton1Click:Connect(function()
	StarterGui:SetCore("SendNotification", {Title="s0ul Hub"; Text="FarmHub : stub activé (pas d'automatisation serveur)"; Duration=4})
	print("[s0ul] FarmHub appelé - Stub sécurisé.")
end)
farmRow.off.MouseButton1Click:Connect(function()
	StarterGui:SetCore("SendNotification", {Title="s0ul Hub"; Text="FarmHub désactivé"; Duration=3})
end)

-- Close / open
closeBtn.MouseButton1Click:Connect(function()
	s0ul.Visible = false
end)

openIcon.MouseButton1Click:Connect(function()
	s0ul.Visible = true
end)

-- Notifications welcome
StarterGui:SetCore("SendNotification", {
	Title = "s0ul Hub",
	Text = "Interface chargée (mode Studio / local).",
	Duration = 4
})

-- Ensure safe cleanup on leaving
Players.LocalPlayer.AncestryChanged:Connect(function()
	if not Players.LocalPlayer:IsDescendantOf(game) then
		disableESP()
	end
end)
